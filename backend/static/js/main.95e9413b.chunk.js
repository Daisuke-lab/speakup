(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{27:function(e,t,s){},79:function(e,t,s){"use strict";s.r(t);var n=s(1),a=s(0),c=s.n(a),i=s(21),r=s.n(i),o=s(16),l=s(12),u=(s(58),"AUTH_START"),j="AUTH_SUCCESS",d="AUTH_FAIL",h="AUTH_LOGOUT",m=s(5),b=function(e,t){return Object(m.a)(Object(m.a)({},e),t)},p={token:null,username:null,error:null,loading:!1},g=function(e,t){return console.log("authStart"),b(e,{error:null,loading:!0})},O=function(e,t){return console.log("authSucces"),b(e,{token:t.token,username:t.username,error:null,loading:!1})},f=function(e,t){return b(e,{error:t.error,loading:!1})},x=function(e,t){return b(e,{token:null,username:null})},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return g(e);case j:return O(e,t);case d:return f(e,t);case h:return x(e);default:return e}},k=s(11),y=s(10),w=s(14),N=s(13),S=s(28),M=s(30),T=s.n(M),C=function(){return console.log("authStart in the action"),{type:u}},I=function(e,t){return console.log("token::",t),{type:j,token:t,username:e}},D=function(e){return{type:d,error:e}},A=function(){return localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("expirationDate"),{type:h}},F=function(e){return function(t){setTimeout((function(){t(A())}),1e3*e)}},R=s(3),H=s(48),_=s(19),L=function(){function e(){Object(k.a)(this,e),this.callbacks={},this.socketRef=null}return Object(y.a)(e,null,[{key:"getInstance",value:function(){return e.instace||(e.instance=new e),e.instance}}]),Object(y.a)(e,[{key:"connect",value:function(){var e=this;this.socketRef=new WebSocket("ws://127.0.0.1:8000/ws/chat/test/"),this.socketRef.onopen=function(){console.log("open")},this.socketNewMessage(JSON.stringify({command:"messages"})),this.socketRef.onmessage=function(t){e.socketNewMessage(t.data)},this.socketRef.onclose=function(){console.log("close"),e.connect()},this.socketRef.onerror=function(e){console.log(e.message)}}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),s=t.command;console.log("parseData::",t),0!==Object.keys(this.callbacks).length&&("messages"===s&&this.callbacks[s](t.messages),"new_message"===s&&this.callbacks[s](t.message))}},{key:"fetchMessages",value:function(e){this.sendMessage({command:"fetch_messages",username:e})}},{key:"newChatMessage",value:function(e){console.log("newChatMessage::",e),this.sendMessage({command:"new_message",from:e.from,message:e.content})}},{key:"addCallbacks",value:function(e,t){this.callbacks.messages=e,this.callbacks.new_message=t}},{key:"sendMessage",value:function(e){console.log("data in sendMessage",e);try{this.socketRef.send(JSON.stringify(Object(m.a)({},e)))}catch(t){console.log(t.message)}}},{key:"state",value:function(){return this.socketRef.readyState}}]),e}();L.instance=null;var U=L.getInstance(),J=(s(27),function(e){Object(w.a)(s,e);var t=Object(N.a)(s);function s(e){var a;return Object(k.a)(this,s),(a=t.call(this,e)).renderMessages=function(e){return e.map((function(e){return Object(n.jsxs)("li",{className:"kikuchi"===e.author?"sent":"replies",children:[Object(n.jsx)("img",{src:"http://emilcarlsson.se/assets/mikeross.png"}),Object(n.jsxs)("p",{children:[e.content,Object(n.jsx)("br",{}),Object(n.jsx)("small",{children:e.timestamp.substring(0,16)})]})]},e.id)}))},a.messageChangeHandler=function(e){a.setState({message:e.target.value})},a.sendMessageHandler=function(e){e.preventDefault();var t={from:"kikuchi",content:a.state.message};t.content&&(console.log(t.content),U.newChatMessage(t),a.setState({message:""}))},a.state={messages:[],message:""},a.waitForSocketConnection((function(){U.addCallbacks(a.setMessage.bind(Object(_.a)(a)),a.addMessage.bind(Object(_.a)(a))),U.fetchMessages("daisuke")})),a}return Object(y.a)(s,[{key:"waitForSocketConnection",value:function(e){var t=this;setTimeout((function(){if(1===U.state())return console.log("connection is secure"),void e();console.log("waiting for connection ...."),t.waitForSocketConnection(e)}),100)}},{key:"setMessage",value:function(e){this.setState({messages:e.reverse()})}},{key:"addMessage",value:function(e){this.setState({messages:[].concat(Object(H.a)(this.state.messages),[e[0]])})}},{key:"render",value:function(){var e=this.state.messages;return Object(n.jsxs)("div",{id:"frame",children:[Object(n.jsx)("div",{className:"messages",children:Object(n.jsx)("ul",{id:"chat-log",children:e&&this.renderMessages(e)})}),Object(n.jsx)("div",{className:"message-input",children:Object(n.jsx)("form",{onSubmit:this.sendMessageHandler,children:Object(n.jsxs)("div",{className:"wrap",children:[Object(n.jsx)("input",{onChange:this.messageChangeHandler,value:this.state.message,id:"chat-message-input",type:"text",placeholder:"Write your message..."}),Object(n.jsx)("i",{className:"fa fa-paperclip attachment","aria-hidden":"true"}),Object(n.jsx)("button",{id:"chat-message-submit",className:"submit",children:Object(n.jsx)("i",{className:"fa fa-paper-plane","aria-hidden":"true"})})]})})})]})}}]),s}(c.a.Component)),W=function(){return Object(n.jsx)("div",{children:Object(n.jsx)(R.a,{exact:!0,path:"/:chatID/",component:J})})},B=s(81),E=function(e){Object(w.a)(s,e);var t=Object(N.a)(s);function s(){var e;Object(k.a)(this,s);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={loginForm:!0},e.changeForm=function(t){t.isTrusted&&e.setState({loginForm:!e.state.loginForm})},e.authenticate=function(t){t.preventDefault(),e.state.loginForm?e.props.login(t.target.username.value,t.target.password.value):e.props.signup(t.target.username.value,t.target.email.value,t.target.password.value,t.target.password2.value)},e}return Object(y.a)(s,[{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{id:"sidepanel",children:[Object(n.jsx)("div",{id:"profile",children:Object(n.jsxs)("div",{className:"wrap",children:[Object(n.jsx)("img",{id:"profile-img",src:"http://emilcarlsson.se/assets/mikeross.png",className:"online",alt:""}),Object(n.jsx)("p",{children:"Mike Ross"}),Object(n.jsx)("i",{className:"fa fa-chevron-down expand-button","aria-hidden":"true"}),Object(n.jsx)("div",{id:"status-options",children:Object(n.jsxs)("ul",{children:[Object(n.jsxs)("li",{id:"status-online",className:"active",children:[Object(n.jsx)("span",{className:"status-circle"})," ",Object(n.jsx)("p",{children:"Online"})]}),Object(n.jsxs)("li",{id:"status-away",children:[Object(n.jsx)("span",{className:"status-circle"})," ",Object(n.jsx)("p",{children:"Away"})]}),Object(n.jsxs)("li",{id:"status-busy",children:[Object(n.jsx)("span",{className:"status-circle"})," ",Object(n.jsx)("p",{children:"Busy"})]}),Object(n.jsxs)("li",{id:"status-offline",children:[Object(n.jsx)("span",{className:"status-circle"})," ",Object(n.jsx)("p",{children:"Offline"})]})]})}),Object(n.jsx)("div",{id:"expanded",children:this.props.loading?Object(n.jsx)(B.a,{}):this.props.isAuthenticated?Object(n.jsx)("button",{onClick:function(){return e.props.logout()},className:"authBtn",children:Object(n.jsx)("span",{children:"Logout"})}):Object(n.jsxs)("div",{children:[Object(n.jsxs)("form",{method:"POST",onSubmit:this.authenticate,children:[this.state.loginForm?Object(n.jsxs)("div",{children:[Object(n.jsx)("input",{name:"username",type:"text",placeholder:"username"}),Object(n.jsx)("input",{name:"password",type:"password",placeholder:"password"})]}):Object(n.jsxs)("div",{children:[Object(n.jsx)("input",{name:"username",type:"text",placeholder:"username"}),Object(n.jsx)("input",{name:"email",type:"email",placeholder:"email"}),Object(n.jsx)("input",{name:"password",type:"password",placeholder:"password"}),Object(n.jsx)("input",{name:"password2",type:"password",placeholder:"password confirm"})]}),Object(n.jsx)("button",{type:"submit",children:"Authenticate"})]}),Object(n.jsx)("button",{onClick:this.changeForm,children:"Switch"})]})})]})}),Object(n.jsxs)("div",{id:"search",children:[Object(n.jsx)("label",{htmlFor:"",children:Object(n.jsx)("i",{className:"fa fa-search","aria-hidden":"true"})}),Object(n.jsx)("input",{type:"text",placeholder:"Search contacts..."})]}),Object(n.jsx)("div",{id:"contacts",children:Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{className:"contact",children:Object(n.jsxs)("div",{className:"wrap",children:[Object(n.jsx)("span",{className:"contact-status online"}),Object(n.jsx)("img",{src:"http://emilcarlsson.se/assets/louislitt.png",alt:""}),Object(n.jsxs)("div",{className:"meta",children:[Object(n.jsx)("p",{className:"name",children:"Louis Litt"}),Object(n.jsx)("p",{className:"preview",children:"You just got LITT up, Mike."})]})]})}),Object(n.jsx)("li",{className:"contact active",children:Object(n.jsxs)("div",{className:"wrap",children:[Object(n.jsx)("span",{className:"contact-status busy"}),Object(n.jsx)("img",{src:"http://emilcarlsson.se/assets/harveyspecter.png",alt:""}),Object(n.jsxs)("div",{className:"meta",children:[Object(n.jsx)("p",{className:"name",children:"Harvey Specter"}),Object(n.jsx)("p",{className:"preview",children:"Wrong. You take the gun, or you pull out a bigger one. Or, you call their bluff. Or, you do any one of a hundred and htmlForty six other things."})]})]})})]})}),Object(n.jsxs)("div",{id:"bottom-bar",children:[Object(n.jsxs)("button",{id:"addcontact",children:[Object(n.jsx)("i",{className:"fa fa-user-plus fa-fw","aria-hidden":"true"})," ",Object(n.jsx)("span",{children:"Add contact"})]}),Object(n.jsxs)("button",{id:"settings",children:[Object(n.jsx)("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"})," ",Object(n.jsx)("span",{children:"Settings"})]})]})]})}}]),s}(c.a.Component),Y=Object(l.b)((function(e){return{isAuthenticated:null!==e.token,loading:e.loading}}),(function(e){return{login:function(t,s){return e(function(e,t){return console.log("login"),function(s){s(C()),T.a.post("http://127.0.0.1:8000/rest-auth/login/",{username:e,password:t}).then((function(t){console.log("res::",t);var n=t.data.key,a=new Date((new Date).getTime()+36e5);console.log("token1::",n),localStorage.setItem("token",n),localStorage.setItem("username",e),localStorage.setItem("expirationDate",a),s(I(e,n)),s(F(3600))})).catch((function(e){s(D(e))}))}}(t,s))},logout:function(){return e(A())},signup:function(t,s,n,a){return e(function(e,t,s,n){return function(a){a(C()),T.a.post("http://127.0.0.1:8000/rest-auth/registration/",{username:e,email:t,password1:s,password2:n}).then((function(t){var s=t.data.key,n=new Date((new Date).getTime()+36e5);localStorage.setItem("token",s),localStorage.setItem("username",e),localStorage.setItem("expirationDate",n),a(I(e,s)),a(F(3600))})).catch((function(e){a(D(e))}))}}(t,s,n,a))}}}))(E),G=function(e){return e.children},P=function(e){Object(w.a)(s,e);var t=Object(N.a)(s);function s(){return Object(k.a)(this,s),t.apply(this,arguments)}return Object(y.a)(s,[{key:"render",value:function(){return Object(n.jsx)("div",{className:"contact-profile",children:null!==this.props.username?Object(n.jsxs)(G,{children:[Object(n.jsx)("img",{src:"http://emilcarlsson.se/assets/harveyspecter.png",alt:""}),Object(n.jsx)("p",{children:this.props.username}),Object(n.jsxs)("div",{className:"social-media",children:[Object(n.jsx)("i",{className:"fa fa-facebook","aria-hidden":"true"}),Object(n.jsx)("i",{className:"fa fa-twitter","aria-hidden":"true"}),Object(n.jsx)("i",{className:"fa fa-instagram","aria-hidden":"true"})]})]}):null})}}]),s}(c.a.Component),q=Object(l.b)((function(e){return{username:e.username}}))(P),z=function(e){Object(w.a)(s,e);var t=Object(N.a)(s);function s(){return Object(k.a)(this,s),t.apply(this,arguments)}return Object(y.a)(s,[{key:"componentDidMount",value:function(){this.props.onTryAutoSignup()}},{key:"render",value:function(){return Object(n.jsx)(S.a,{children:Object(n.jsxs)("div",{id:"frame",children:[Object(n.jsx)(Y,{}),Object(n.jsxs)("div",{className:"content",children:[Object(n.jsx)(q,{}),Object(n.jsx)(W,{})]})]})})}}]),s}(c.a.Component),K=Object(l.b)(null,(function(e){return{onTryAutoSignup:function(){return e((function(e){var t=localStorage.getItem("token"),s=localStorage.getItem("username");if(void 0===t)e(A());else{var n=new Date(localStorage.getItem("expirationDate"));n<=new Date?e(A()):(e(I(s,t)),e(F((n.getTime()-(new Date).getTime())/1e3)))}}))}}}))(z),Q=s(46),V=s(47),X=Object(o.createStore)(v,Object(Q.composeWithDevTools)(Object(o.applyMiddleware)(V.a))),Z=Object(n.jsx)(l.a,{store:X,children:Object(n.jsx)(K,{})});r.a.render(Z,document.getElementById("app"))}},[[79,1,2]]]);
//# sourceMappingURL=main.95e9413b.chunk.js.map